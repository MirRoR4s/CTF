<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BASIC &mdash; CTF 0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=44496db0"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            CTF
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">CTF</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../2023/Lexington-Informatics-Tournament.html">Lexington Informatics Tournament CTF 2023</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../2023/tamu.html">TAMUctf 2023</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CTF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">BASIC</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/source/2022/TFCCTF/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <!--toc-->
<p>同样总体难度不大，但是挺好玩的0_0</p>
<!--more-->
<p>官方的code：https://github.com/tomadimitrie/tfcctf-2022-challenges</p>
<p>[TOC]</p>
<section id="basic">
<h1>BASIC<a class="headerlink" href="#basic" title="Permalink to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">Rn</span><span class="o">/</span><span class="n">X7n</span><span class="c1">#bUc.rjzh,|eEsg,?&amp;QI;@^ARm}UKOkICi#X.ixEmN]D</span>
</pre></div>
</div>
<p>base91拿flag</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TFCCTF</span><span class="p">{</span><span class="n">sh3</span><span class="s1">&#39;s_4_10..._but_0n_th3_ph_sc4l3}</span>
</pre></div>
</div>
</section>
<section id="obscure">
<h1>OBSCURE<a class="headerlink" href="#obscure" title="Permalink to this heading"></a></h1>
<p>太离谱了，这不是crypto。。。</p>
<p>放在记事本里面放大看就可以</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>T̶̨̧͈͍̥͚̭̜͇̻̥̘̹̝̩͍̦̜͕͉̥̳͑̎͋͊͛͗̆͐̄͂̀̒͛̉̿̏̈̕̚̚̕͝͝͝ͅF̶̡̛̛͖̝̹̹͔̟̝̟̠̩̲̱͉̻̭̻̮͓̲̮͈̜̅̔̈͐̀̾̋͊̈́͛͆̿̀̓͐̓͋̃͛̃́̑̀̽͂̋̌̐̎̕̕͘͝͠͝͝ͅC̵̢̨̨͓̞̥̠̲̗̝̯̥̥͚̙̰̣̼̻̤̳͓͙̺̤͊̍͊̌̍̎̀̅̽͊͘͘͘͜͝͠͝͝ͅÇ̶̼̫͎̬̰͓̰̭̺̼̥̮͖͗̾͐́̉͂͂͗̏̿̂̀͝͝Ṭ̷̛͓̑̓̓̒́̋̒̃̋͊̑̎͐͐̋̈̆̉́̀̏͑̀̾̎͒̾̉̃̄̊͂́͐̈́͘͘͜͝͝F̴̢̨̡̛̥̠̪̤̞͔̝̞̳̱̙̰̲̙̠̬̻̥̜͔̲̯͚̳̖̩̺͈̬͍̪̥̯͙̱͙͔̞̰̮̦̼̼͐͒͆̿̓̓͑̎͊̋͂͑̅̈́͗̃͆͊̓̆̈́͂́̆͌͂̈̔́̔̎̀̾̕̕̚͝͝͝͝͠ͅ{̴̧̡̡̛͈̻̥̙̯̜͓̥̣͔̣͐̄̂̋͋̏͋̌̍̔̀̎̿̍̈́̐̏͒̓̒̉̐́̓̓̽̕̕͝͠s̴̝̬͒̾͗̌̓͊̚ͅ3̷̢̧͓̬̳̯̜̦͉̜̗͚̗̳̩̻͉͍̼͓͍̼͚̝͔͙̗̞͎͚̼͈̹̞͋̉̆̈́͊̐̓̔͋̈͂́̔̈́͒͗̀́̂̏͒͜͝ç̷̛͉͔̮̯̳͚̘̜͇̗͖̟̫̇͋̇̑͆̀͊̈̌̅̀̿̓͊̓̀̉́̀̓̋̊͐͊̒̌͒͒̈́̒̅̀̽̾͗̾͌̃̉̾̚̚̕̕͝͝ư̵̼̑̔͌̉͆͒̅͗̆̑̌̀̀͗̒̾̎͆̇̄̃̀̒̉̂͂̀̍̃̄̈͐̈́̔̔̈́̽̚͘̕͘ͅr̵̛̼͊̽̔̋͠1̶̧̡̨̡̢̧̡̛̗̼͓̣͖̖̖̫̲̻̰͇̫̘̖̞͖̬̤͔̙̠̪̦͙̮̝̫͔͕͈̗̙͇̫̩̫͔̩͂̾͆̈́̂̌͋̕͜͜ͅͅṭ̶̡̢̢̧̨̡̡̨̧̨̛͔̜̳̥̤̰̖̩̟̬̰̖̥̹̼͈̦̥̣͇̭͎̻̻͔̪͍̻̜͎͉͙͇̣̿̑̂̈́̇̉̄͑̅͂͐̒̽́̀̏̓̂͑͐͌̈̂̔͑̐͆̐̏͆́́̾̑̈́͑͌͐̓̊̕̚͘͜ͅẙ̸̢̨̛̹̻͉͇͎̭̻̙̭͔͎̺̤̤̻͓̼̮͈̤͈͈̠̞̪̠͉̗̺̟̙͈̖̲̪̫̖͔̟̟̇̇̿̎̊̀̊̔͌̀̀͒͐͋̀̍̃͒̂̈́͆͋̍͐̑̀̓̿̓̈́͑̊̇͆̿̓͐̓̉̕͘̕̕̚͜͠͝_̷̡̡̨̡̛̛̗̩͔̫̗̭̟̣̗͙͇͇̩̣̼̟̱͖̯̥͎̽͋́̽̈́̎͗̿͊͗͂̒̓͑͛̾̄̿͛̄͛͛́͌͐̀t̷̢̛̰̟̹͖̪̝͕̭̩͚̬̙̃͐̎͐͂͒͆̒̔̊̀͛̂̿̑̀̇͊͋̇̌̅͛̀͂͋̿̈́̈́̽̍̕͝͠͝ḩ̶̢̡̡̛̺͈̺̙͚̪͕͚̹̺̥͚̦͚̺̯̬̣͚͕͔̖̝̞̖͔̙͉͔̟̼͕͖̙̐̃͋̈͛̽́̔̈͐́́̒̏̂̄̊̔̿̍̀̓̅̽̆̍̐̌̈́̋̈́̀̿̓̐́̐͌̓͘̚͘͜͠͝͠͝ͅr̸̢̡͙̼̜̬̤̗̯̪͇̩͓͕͓͓̝͇͖̎͂̏͆͝ͅ0̷̨̛̛̛̛̯̖̞̮̦̞̫̜͕̱̻̞͎̯͎̮͑̿͆̀͛̔͆̈́̈̆̑̄̅͂̇̄́̀́̒̋̇̓̍̀̈́̂̈́̀̀̂̅̅̑́͌̋̈́͘̕̕̕̚͝ų̶̧̡̢̖͓̲̞̭̗̦̠̹̥̙̱̙̥̯̗̭̩͙͔̜̙̼̻̼̞͛̂͆̀̾̃̈́͑̈́̔̈́̾̉̄̌͗̀͊̔̈́̌́͜͠͝͠g̷̢̨̡̜̩̘̺͎̮̻̼͙̱̱͈̣̳̣̻̜͒̓͗̍͌̈́͌̉͑̽̕͝͝ͅh̸̛̛͓̯̣̼̫̦̐͗̀̾̉̅̑́͌̈́͌́͑̔̈́̇̄͘̕͝͝_̶̭̹̩̳̯͙̯͕͔̼̔̈͑̉͗͌̚͜͝0̵̢̧̛͎̭̣͈̼̳͍͚͖̲͚̗̮͖̲̼͍̼̮̖̩͖̫͔̱͓̥̯̹̥͎͖̳͈̻̝̬̪̙̪̩̬̀̉̽̂̑̓̓͐̂̐̉͆̇́̂͌̈́̏͆͗̒̋̅̋̚̕͜͜͜͝͠ͅḇ̵̨̡̨͍͖͔͚̰̠͚͇̤̝̦̺͎͙̱̭̥̼̹̞͓̜̙͕͕͚͍̩͈̭̱͖̍̌̇͆̄̏̃͌͆͛̑̀͑̂̅̍̔̐̾̽̓̑̈̇͑̃̉̎͂̐̅̆́͐̿͌͗̕͘̚̕͘̕̚͘͜͝͝͝ͅͅs̸̡̨̯̬̰̠̖̟̹͈̞͎͉͉͓̠̺̹̣̲̺̬̜̝͓͓̰͍̖̹̮̹̩̥̆̾̐͘ͅç̷̡̩͍̥̘̳̺͎͉͓͖̭̝̖̹̬̗̞̲̞̬̹̼̱̫͓͙̤̤̖̦͕͓̱̝̯͇̼͚͕̳̿͆̀͒͊̎̅͐̂͗̾̀͊͑͊́̊̈͒͂̾́͂̓̓̀̏͋͂̿̆̀͒̇̚͘͝͝ͅü̶̧̨̡̲̩̥͇̘͇̣͕̞̗͓̳̗͉̲͔̻̪̪͕̖͈̪̳̤̤͈̫̹͉̞̝͖͎͕̥̻̣̖̼̰̣̰̦̈̂̿̉̋̂̔̎̓͂̎̍̾̉͂̆̈͌̐͆̓̊͋͑͒̚͜͜͠͝͠͝͝ͅr̵̨̢̨̡̡͓̭͍̲̗͍̼̬̰̗̱̩̼̰̤͓̞̤͔͇͎̪̱̱̺͈̭͆͜ͅ1̶̡̧̨̛͕̟̹͚̹̫̮̖͚̯̲̰̤̙͉͌͆̈́̽̀͗̿̓̑͒̄̌̓̓̓͗̇̒̃̑̏̊͑̋̅̎̔͂͑̔͑̈̄̉̚͘͝ṭ̶̡̼̲͓̺̝̱̮͈̱͈͔̞̙͚̝̬̳͑͌͆̀̆̄͆̀͌͐̂̽̓̾͂̀́͗͗̍͒̆̏̓͌͒͌́̒̑̐́̃͘͝͝ẏ̸̨̡̨̞̰̜̜̟̦͎̣͍͎̳̝̮̼̦͚̮̖͈̺͓̮̲̤͙̞͕̰͖̩̭̮̯̆̌̊́̀̈́̈́̓̈́͛̌̈́́̄͋̍̇̍͌͑̃̀̈̐̋̄̐̈́̉͌̀̀̀͑̏͐̄́̿̅̽͊̉͘͘͜͝͝͠ͅͅ}̴̨̧̡̨̛̛̞̝̼̫͈̝̞̣̣͈̥̫͙̻͓̯̮̻͇̤̦̼͍̱̥̞̥͔̙̹̲͈̲̥̤͚͚͕̺̫̗͍͖͎̆͗̍̈͠ͅͅ





TFCCTF{s3cur1ty_thr0ugh_0bscur1ty}
</pre></div>
</div>
</section>
<section id="mafioso">
<h1>MAFIOSO<a class="headerlink" href="#mafioso" title="Permalink to this heading"></a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f433c3e883a1389482c0b652660580f36ea037434fd4a67d193bc1cdc9b2cc34</span>
</pre></div>
</div>
<p>尝试直接转bytes但是得到了没有意义的字符串，随后观察密文的长度可以发现是64位，猜测是sha256的哈希。送到网站解拿到flag</p>
</section>
<section id="exclusive-oracle">
<h1>EXCLUSIVE ORACLE<a class="headerlink" href="#exclusive-oracle" title="Permalink to this heading"></a></h1>
<p>迷茫。无语了很简单的题，但是过了一周复现我忘记题目具体是啥样了。似乎是给服务器发送一个40字节的消息，然后服务器回返回一个密文。看wp的意思加密过程应该是将我们发送的消息跟flag进行异或，异或结果作为密文返回。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">DATA</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">40</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;01.linux.challenges.ctf.thefewchosen.com&#39;</span><span class="p">,</span> <span class="mi">58166</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">((</span><span class="n">DATA</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>
<span class="n">xorred</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
<span class="n">xorred_data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">xorred</span><span class="p">[</span><span class="mi">80</span><span class="p">:])</span><span class="c1">#2个十六进制一个字节</span>
<span class="n">xorred_flag</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">xorred</span><span class="p">[:</span><span class="mi">80</span><span class="p">])</span>

<span class="n">secret</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">xorred_data</span><span class="p">,</span> <span class="n">xorred_flag</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span>
</pre></div>
</div>
<p>从dircord上关于比赛的聊天中发现了本题的讯息，好像是密钥是40字节长，然后重复地加密了两段明文，一段是flag，一段是我们输入的，然后<code class="docutils literal notranslate"><span class="pre">tzlil</span></code>通过发送TFCCTF发现了这件事情，所以他推断出来了这个情况</p>
<p><img alt="image-20220806202858420" src="source/2022/TFCCTF/C:%5CUsers%5Cmirror%5CDesktop%5Cwrite-up%5Cblog%5Csource%5Cimages%5Cimage-20220806202858420.png" /></p>
<p><img alt="image-20220806202936007" src="source/2022/TFCCTF/C:%5CUsers%5Cmirror%5CDesktop%5Cwrite-up%5Cblog%5Csource%5Cimages%5Cimage-20220806202936007.png" /></p>
</section>
<section id="train-to-paddington">
<h1>TRAIN TO PADDINGTON<a class="headerlink" href="#train-to-paddington" title="Permalink to this heading"></a></h1>
<p>第一步将flag进行pad_pt</p>
<p>第二步生成一个16字节的密钥</p>
<p>第三步进行分组加密，具体操作是将pad后的flag跟key进行分组异或，随后按照大端字节序转成bytes，将这个过程得到的bytes拼接起来得到一个密文。最后告诉我们密文的十六进制值。不难发现这其实相当于一个ECB模式的分组加密。同一个密钥key被用来加密多个明文分组。填充的手法也很简单，如果flag的长度是16的整数倍，那么填充上16个<code class="docutils literal notranslate"><span class="pre">\x3f</span></code>这个时候根据flag的格式是<code class="docutils literal notranslate"><span class="pre">TFCCTF{</span></code> 来进行已知明文攻击。尝试利用末尾的填充字符还原key，用以下脚本解密一部分密文</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;b4b55c3ee34fac488ebeda573ab1f974bf9b2b0ee865e45a92d2f14b7bdabb6ed4872e4dd974e803d9b2ba1c77baf725&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;TFCCTF{&#39;</span>
<span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">tmp_key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="n">tmp_key</span> <span class="o">+=</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
<span class="n">tmp_key</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">16</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp_key</span><span class="p">))</span><span class="o">*</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_key</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">c3</span><span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">m1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<span class="n">m2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<span class="n">m3</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
    <span class="n">m1</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">tmp_key</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">tmp_key</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
    <span class="n">m3</span> <span class="o">+=</span> <span class="p">(</span><span class="n">c3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">tmp_key</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">b&#39;TFCCTF{H\x8e\xbe\xdaW:\xb1\xf9t&#39;</span>
<span class="sd">b&#39;_h4s_l3Z\x92\xd2\xf1K{\xda\xbbn&#39;</span>
<span class="sd">b&#39;4t10n}?\x03\xd9\xb2\xba\x1cw\xba\xf7%&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>


</pre></div>
</div>
<p>从最后一个恢复出的部分明文可以知道<code class="docutils literal notranslate"><span class="pre">4t10n}</span></code>后面全是填充字符加密而来，所以我们可以知道key的第7个到第16个字节，再结合我们已知知道的前7个，成功恢复key。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;b4b55c3ee34fac488ebeda573ab1f974bf9b2b0ee865e45a92d2f14b7bdabb6ed4872e4dd974e803d9b2ba1c77baf725&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;TFCCTF{&#39;</span>
<span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">tmp_key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xe0\xf3\x1f</span><span class="s1">}</span><span class="se">\xb7\t\xd7</span><span class="s1">&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tmp_key</span><span class="p">)</span>
<span class="n">pad</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x3f</span><span class="s1">&#39;</span>
<span class="n">h_p</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x03\xd9\xb2\xba\x1c</span><span class="s1">w</span><span class="se">\xba\xf7</span><span class="s1">%&#39;</span>
<span class="n">key1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">h_p</span><span class="p">:</span>
    <span class="n">key1</span><span class="o">+=</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span><span class="o">^</span> <span class="n">i</span> <span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
<span class="c1">#print(key1)</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">tmp_key</span> <span class="o">+</span> <span class="n">key1</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">==</span><span class="mi">16</span>
<span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">flag</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&#39;</span>
<span class="n">j</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)):</span>
    <span class="n">flag</span> <span class="o">+=</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">^</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
    <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>
    <span class="n">j</span><span class="o">%=</span><span class="mi">16</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>


</pre></div>
</div>
<p>做完才发现题目很细心的在两个交界处加了一个问号</p>
</section>
<section id="admin-panel">
<h1>ADMIN PANEL<a class="headerlink" href="#admin-panel" title="Permalink to this heading"></a></h1>
<p>读题之后发现是输入正确的密码就可以获取flag。</p>
<p>选项2提供了一个改密的功能，在这里有一个关键点就是我们可以修改密码，并且修改的密码我们可以想办法获得。我们先输入一个长为64的十六进制token，然后服务器那边会随机生成一个字节，然后跟我们发送的token进行异或。最后的异或值经过decrypt函数就是修改后的PASSWD,这里只需要注意如果我们发送token为全0，然后这个token只跟一个字节异或然后送去decrypt，这就导致b的值固定不变。所以我们的操作就是发个token过去，然后本地爆破出256个可能的b，然后向服务器请求256个可能的decrypt(xorred)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="n">KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="n">bytes_second</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bytes_second</span><span class="p">)):</span>
        <span class="n">d</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">byte</span> <span class="o">^</span> <span class="n">bytes_second</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">):</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
    <span class="c1">#pt = b&#39;&#39;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">iv</span>
    <span class="n">M</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ct</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">b</span> <span class="o">^</span> <span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pt</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">M</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">M</span>

<span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;00&#39;</span><span class="o">*</span><span class="mi">32</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">hex_token</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">ip</span> <span class="o">=</span> <span class="s2">&quot;01.linux.challenges.ctf.thefewchosen.com&quot;</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">54089</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt; &#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Token &gt; &quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;XORing with: &quot;</span><span class="p">)</span>
<span class="n">r_byte</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">r_byte</span> <span class="o">=</span> <span class="n">r_byte</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c1">#print(xor)</span>
<span class="c1">#r.sendline(b&#39;1&#39;)</span>
<span class="n">r_byte</span> <span class="o">=</span> <span class="n">r_byte</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="c1">#print(&#39;r_byte=&#39;,r_byte)</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">r_byte</span><span class="p">)</span>
<span class="n">xorred</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hex_token</span><span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">xorred</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">M</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="admin-panel-but-harder">
<h1>ADMIN PANEL BUT HARDER<a class="headerlink" href="#admin-panel-but-harder" title="Permalink to this heading"></a></h1>
<p>啊这。。源码丢了，好像跟压轴题差不多，我忘记了。</p>
</section>
<section id="admin-panel-but-harder-and-fixed-python">
<h1>ADMIN PANEL BUT HARDER AND FIXED-python的伪随机数预测<a class="headerlink" href="#admin-panel-but-harder-and-fixed-python" title="Permalink to this heading"></a></h1>
<p>题目：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>

<span class="n">KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">FLAG</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;FLAG&#39;</span><span class="p">)</span>

<span class="n">menu</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;========================</span>
<span class="s2">1. Access Flag</span>
<span class="s2">2. Change Password</span>
<span class="s2">========================&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">bytes_first</span><span class="p">,</span> <span class="n">bytes_second</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bytes_second</span><span class="p">)):</span>
        <span class="n">d</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">bytes_first</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">bytes_second</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">):</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">KEY</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
    <span class="n">pt</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">iv</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ct</span><span class="p">)):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">b</span> <span class="o">^</span> <span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pt</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">pt</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>
        <span class="n">option</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;&gt; &quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">password</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Password &gt; &quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">password</span> <span class="o">==</span> <span class="n">PASSWORD</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">FLAG</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrong password!&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Token &gt; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">64</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrong length!&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">hex_token</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="n">r_bytes</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;XORing with: </span><span class="si">{</span><span class="n">r_bytes</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">xorred</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">r_bytes</span><span class="p">,</span> <span class="n">hex_token</span><span class="p">)</span>
            <span class="n">PASSWORD</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">xorred</span><span class="p">)</span>

</pre></div>
</div>
<p>随机生成的密钥是32个字节了，这就使得我们可以控制的state无法保持一个值不变。题目变得困难起来。</p>
<p>之前做题的时候就想着可不可以让传入decrypt函数的值为全0，这样16轮的b值都是一样的，只需要枚举256个可能的b就可以解出flag。但是由于<code class="docutils literal notranslate"><span class="pre">r_bytes</span></code>是后于我们发送的信息生成，然后我就卡住了。</p>
<p>后面看答案是提到利用<code class="docutils literal notranslate"><span class="pre">random.randbytes</span></code> 的弱点去预测出这个<code class="docutils literal notranslate"><span class="pre">r_bytes</span></code>来。具体的预测原理我没有关注，是利用一个叫做https://github.com/kmyk/mersenne-twister-predictor的工具，利用条件是要有624个32bit的整数。回到本题中来，我们可以不断地向服务器发起请求，然后就可以获得一个32字节的r_bytes。但是问题在于32字节的r_bytes跟32bit的整数有关系吗？答案是有！</p>
<p>可以看如下的测试：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">libnum</span> <span class="kn">import</span> <span class="n">n2s</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test1</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">n2s</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)])</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
<span class="n">test2</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">test2</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test2</span><span class="p">),</span> <span class="mi">8</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test 1: </span><span class="si">{</span><span class="n">test1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test 2: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Test 1: d82c07cd 629f6fbe c2094cac e3e70682 6baa9455 0a5d2f34 42485e3a f728b4fa</span>
<span class="c1"># Test 2: cd072cd8 be6f9f62 ac4c09c2 8206e7e3 5594aa6b 342f5d0a 3a5e4842 fab428f7</span>
</pre></div>
</div>
<p>​	我们发现<code class="docutils literal notranslate"><span class="pre">randbytes(32)</span></code>按照8个字节分组 正好是  8次 <code class="docutils literal notranslate"><span class="pre">getrandbits(32)</span></code>得到的十六进制数的逆序(每一组)。猜测是由于字节序不同而导致的，但无论如何这告诉我们<code class="docutils literal notranslate"><span class="pre">randbytes(32)</span></code>可以转成一个32bit的数字。 所以我们现在只要得到624个32比特的数字就可以预测出<code class="docutils literal notranslate"><span class="pre">r_bytes</span></code>的值。我们换算一下，一次请求可以得到一个32字节也就是256比特的数据，我们需要$624*32$比特的数据，所以我们最终需要$624/8$个次请求</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># nc 01.linux.challenges.ctf.thefewchosen.com 50682</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">libnum</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mt19937predictor</span> <span class="kn">import</span> <span class="n">MT19937Predictor</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">trange</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="s2">&quot;01.linux.challenges.ctf.thefewchosen.com&quot;</span><span class="p">,</span> <span class="mi">53505</span>



<span class="k">def</span> <span class="nf">local</span><span class="p">():</span>
    <span class="n">predictor</span> <span class="o">=</span> <span class="n">MT19937Predictor</span><span class="p">()</span>
    <span class="n">KEY</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mi">16</span>

    <span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">bytes_first</span><span class="p">,</span> <span class="n">bytes_second</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bytes_second</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">bytes_first</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">bytes_second</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">):</span>
        <span class="n">iv</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">KEY</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">iv</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ct</span><span class="p">)):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">state</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">b</span> <span class="o">^</span> <span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pt</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">c</span><span class="p">])</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">ct</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">pt</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">624</span><span class="o">//</span><span class="mi">8</span><span class="p">)]</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2n</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span><span class="mi">4</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">predictor</span><span class="o">.</span><span class="n">setrandbits</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total count:&quot;</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="p">[</span><span class="n">predictor</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">n2s</span><span class="p">(</span><span class="n">i</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predicted</span><span class="p">])</span>

    <span class="n">r_bytes</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r_bytes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">r_bytes</span> <span class="o">==</span> <span class="n">predicted</span>

    <span class="n">hex_token</span> <span class="o">=</span> <span class="n">predicted</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
    <span class="n">xorred</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">r_bytes</span><span class="o">.</span><span class="n">hex</span><span class="p">()),</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hex_token</span><span class="p">))</span>
    <span class="n">PASSWORD</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">xorred</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">PASSWORD</span><span class="p">)</span>
    <span class="nb">breakpoint</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">solve</span><span class="p">():</span>
    <span class="n">predictor</span> <span class="o">=</span> <span class="n">MT19937Predictor</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">624</span><span class="o">//</span><span class="mi">8</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Count;&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">624</span><span class="p">:</span> <span class="k">break</span>
        <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Token &gt; &#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mi">64</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;XORing with: &#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">s2n</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span><span class="mi">4</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">predictor</span><span class="o">.</span><span class="n">setrandbits</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Count:&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="p">[</span><span class="n">predictor</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">n2s</span><span class="p">(</span><span class="n">i</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predicted</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predicted:&quot;</span><span class="p">,</span> <span class="n">predicted</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Token &gt; &#39;</span><span class="p">,</span> <span class="n">predicted</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
        <span class="n">pw</span> <span class="o">=</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">hex</span><span class="p">())</span><span class="o">*</span><span class="mi">16</span>
        <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Password &gt; &#39;</span><span class="p">,</span> <span class="n">pw</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
        <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;Wrong pass&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>


    <span class="nb">breakpoint</span><span class="p">()</span>

<span class="c1"># local()</span>
<span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
<p>wp番外：</p>
<p>Note that the challenge could be solved by passing <code class="docutils literal notranslate"><span class="pre">b'00'</span> <span class="pre">+</span> <span class="pre">'</span> <span class="pre">'*60</span> <span class="pre">+</span> <span class="pre">b'00'</span></code> as the token, this will cause <code class="docutils literal notranslate"><span class="pre">bytes.fromhex(token)</span></code> to read it as <code class="docutils literal notranslate"><span class="pre">b'\x00\x00'</span></code>. The xorred value will only be 2 bytes long as well, so in the <code class="docutils literal notranslate"><span class="pre">decrypt</span></code> function,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">iv</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
<span class="n">ct</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
</pre></div>
</div>
<p>There is no <code class="docutils literal notranslate"><span class="pre">ct</span></code> so the password comes out as an empty string, so giving an empty string for password will leak the flag.</p>
<p>想法就是利用空格填充长度，然后服务器就读到了一个长为64的，但是实际内容是两个空字节的数据。这样最终传到解密函数的数据就只有2个字节，16的长度。所以ct是空的，那么显然加密结果是空，这时候随便发一个空字节就可以拿到flag。</p>
<p>这个完全就是非预期了，这说明密钥体制的安全性真是跟代码实现息息相关，必须对用户传入的参数做严格的检查。</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, MirRoR4s.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>